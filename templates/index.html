<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Supanel - DNS Y√∂netim Paneli</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",system-ui,-apple-system,sans-serif}
        :root{
            --primary:#6366f1;--primary-dark:#4f46e5;--dark-bg:#0f172a;
            --dark-card:#1e293b;--dark-sidebar:#0f172a;--dark-text:#f1f5f9;
            --muted:#94a3b8;--success:#10b981;--warning:#f59e0b;--error:#ef4444;
            --border:#334155;--sidebar-width:260px;
        }
        body{background:var(--dark-bg);color:var(--dark-text);min-height:100vh;display:flex}
        /* Sidebar */
        .sidebar{width:var(--sidebar-width);background:var(--dark-sidebar);border-right:1px solid var(--border);padding:24px 0;position:fixed;height:100vh;overflow-y:auto}
        .sidebar-header{padding:0 24px 24px;border-bottom:1px solid var(--border);margin-bottom:24px}
        .logo{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:700;color:var(--dark-text);text-decoration:none}
        .logo span{background:linear-gradient(135deg,var(--primary),#8b5cf6);-webkit-background-clip:text;background-clip:text;color:transparent}
        .nav-menu{list-style:none;padding:0 16px}
        .nav-item{margin-bottom:8px}
        .nav-link{display:flex;align-items:center;gap:12px;padding:12px 16px;color:var(--muted);text-decoration:none;border-radius:10px;transition:all .3s;font-size:14px;font-weight:500}
        .nav-link:hover{background:rgba(255,255,255,.05);color:var(--dark-text)}
        .nav-link.active{background:rgba(99,102,241,.1);color:var(--primary)}
        .user-profile{padding:24px 24px 0;margin-top:auto;border-top:1px solid var(--border)}
        .user-info{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,.03);border-radius:10px}
        .user-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--primary),#8b5cf6);display:flex;align-items:center;justify-content:center;color:white;font-weight:600}
        .user-details h4{font-size:14px;font-weight:600;margin-bottom:4px}
        .user-details p{font-size:12px;color:var(--muted)}
        /* Main */
        .main-content{flex:1;margin-left:var(--sidebar-width);padding:0}
        .top-bar{padding:20px 32px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:rgba(15,23,42,.8);backdrop-filter:blur(10px);position:sticky;top:0;z-index:100}
        .page-title h1{font-size:24px;font-weight:600}
        .page-title p{color:var(--muted);font-size:14px;margin-top:4px}
        .user-actions{display:flex;align-items:center;gap:16px}
        .btn-logout{padding:10px 20px;background:rgba(239,68,68,.1);color:#fca5a5;border:1px solid rgba(239,68,68,.2);border-radius:8px;text-decoration:none;font-size:14px;font-weight:500}
        .content{padding:32px}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-bottom:32px}
        .stat-card{background:var(--dark-card);border:1px solid var(--border);border-radius:12px;padding:24px}
        .stat-value{font-size:28px;font-weight:700;margin-bottom:4px}
        .stat-label{color:var(--muted);font-size:14px}
        .cards-grid{display:grid;grid-template-columns:2fr 1fr;gap:24px}
        @media (max-width:1024px){.cards-grid{grid-template-columns:1fr}}
        .card{background:var(--dark-card);border:1px solid var(--border);border-radius:16px;padding:32px}
        .card-header h2{font-size:20px;font-weight:600;margin-bottom:8px}
        .card-header p{color:var(--muted);font-size:14px}
        .form-group{margin-bottom:20px}
        .input-with-suffix{display:flex;align-items:center;background:rgba(15,23,42,.5);border:1px solid var(--border);border-radius:10px;overflow:hidden}
        .input-with-suffix input{flex:1;padding:14px 16px;background:transparent;border:none;color:var(--dark-text);font-size:15px}
        .input-suffix{padding:0 16px;background:rgba(255,255,255,.05);color:var(--muted);font-size:14px;display:flex;align-items:center}
        .btn-create{width:100%;padding:14px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px}
        .table-container{overflow-x:auto;margin-top:16px}
        table{width:100%;border-collapse:collapse}
        thead{background:rgba(255,255,255,.03)}
        th{padding:16px;text-align:left;font-weight:600;font-size:14px;color:var(--muted);border-bottom:1px solid var(--border)}
        td{padding:16px;border-bottom:1px solid var(--border);font-size:14px}
        .domain-cell{font-weight:600;color:var(--dark-text)}
        .status-badge{display:inline-block;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:500}
        .status-active{background:rgba(16,185,129,.1);color:var(--success)}
        .status-inactive{background:rgba(245,158,11,.1);color:var(--warning)}
        .actions{display:flex;gap:8px}
        .btn-action{padding:6px 12px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;border:none}
        .btn-edit{background:rgba(99,102,241,.1);color:var(--primary)}
        .btn-delete{background:rgba(239,68,68,.1);color:#fca5a5}
        .empty-state{text-align:center;padding:48px 24px;color:var(--muted)}
        .alert{padding:16px;border-radius:10px;margin-bottom:24px;font-size:14px;display:none}
        .alert-success{background:rgba(16,185,129,.1);border:1px solid var(--success);color:#a7f3d0}
        .alert-error{background:rgba(239,68,68,.1);border:1px solid var(--error);color:#fca5a5}
        .mobile-menu-btn{display:none}
        @media (max-width:768px){.sidebar{transform:translateX(-100%);transition:transform .3s}.sidebar.active{transform:translateX(0)}.main-content{margin-left:0}.mobile-menu-btn{display:block}}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="/" class="logo"><span>Supa</span>nel</a>
        </div>

        <ul class="nav-menu">
            <li class="nav-item"><a href="/" class="nav-link active"><span class="icon">üè†</span>Dashboard</a></li>
            <li class="nav-item"><a href="/domains" class="nav-link"><span class="icon">üåê</span>Domainlerim</a></li>
            <li class="nav-item"><a href="/dns-records" class="nav-link"><span class="icon">üîó</span>DNS Kayƒ±tlarƒ±</a></li>
            <li class="nav-item"><a href="/analytics" class="nav-link"><span class="icon">üìä</span>Analitikler</a></li>
            <li class="nav-item"><a href="/settings" class="nav-link"><span class="icon">‚öôÔ∏è</span>Ayarlar</a></li>
        </ul>

        <div class="user-profile">
            <div class="user-info">
                <div class="user-avatar">
                    {{ user.name[0] if user and user.name else 'U' }}
                </div>
                <div class="user-details">
                    <h4>{{ user.name if user and user.name else 'Kullanƒ±cƒ±' }}</h4>
                    <p>{{ user.email if user and user.email else 'user@example.com' }}</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <header class="top-bar">
            <div class="page-title">
                <h1>DNS Y√∂netim Paneli</h1>
                <p>Subdomainlerinizi kolayca y√∂netin</p>
            </div>
            <div class="user-actions">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <a href="/logout" class="btn-logout">√áƒ±kƒ±≈ü Yap</a>
            </div>
        </header>

        <div class="content">
            <div id="alert" class="alert"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon domain">üåê</div>
                    <div class="stat-value">{{ subdomains|length }}</div>
                    <div class="stat-label">Toplam Subdomain</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon active">‚úÖ</div>
                    <div class="stat-value">{{ subdomains|selectattr('active','equalto',true)|list|length }}</div>
                    <div class="stat-label">Aktif Domain</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon inactive">‚è∏Ô∏è</div>
                    <div class="stat-value">{{ subdomains|selectattr('active','equalto',false)|list|length }}</div>
                    <div class="stat-label">Pasif Domain</div>
                </div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <h2>Yeni Subdomain Olu≈ütur</h2>
                        <p>Kullanƒ±cƒ±larƒ±nƒ±z i√ßin √∂zel subdomainler olu≈üturun</p>
                    </div>

                    <form id="subForm">
                        <div class="form-group">
                            <label for="sub">Subdomain Adƒ±</label>
                            <div class="input-with-suffix">
                                <input type="text" id="sub" name="sub" placeholder="ornek" pattern="[a-z0-9\-]+" required>
                                <div class="input-suffix">.supanel.org</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="target">Hedef URL (Opsiyonel)</label>
                            <input type="url" id="target" name="target" placeholder="https://example.com" class="input-with-suffix input">
                        </div>

                        <div class="form-group">
                            <label for="description">A√ßƒ±klama (Opsiyonel)</label>
                            <input type="text" id="description" name="description" placeholder="Bu domain ne i√ßin kullanƒ±lacak?" class="input-with-suffix input">
                        </div>

                        <button type="submit" class="btn-create"><span>Subdomain Olu≈ütur</span><span>+</span></button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Hƒ±zlƒ± ƒ∞≈ülemler</h2>
                        <p>Sƒ±k kullanƒ±lan i≈ülemler</p>
                    </div>

                    <div class="quick-actions">
                        <a href="/domains" class="quick-action">
                            <div class="icon">‚ûï</div>
                            <div>
                                <div style="font-weight:600;">Toplu Domain Ekle</div>
                                <div style="font-size:12px;color:var(--muted);">CSV dosyasƒ± ile ekleyin</div>
                            </div>
                        </a>

                        <a href="/dns-records" class="quick-action">
                            <div class="icon">‚ö°</div>
                            <div>
                                <div style="font-weight:600;">DNS Ayarlarƒ±</div>
                                <div style="font-size:12px;color:var(--muted);">A, CNAME, MX kayƒ±tlarƒ±</div>
                            </div>
                        </a>

                        <a href="/analytics" class="quick-action">
                            <div class="icon">üìà</div>
                            <div>
                                <div style="font-weight:600;">Trafik Raporu</div>
                                <div style="font-size:12px;color:var(--muted);">Son 30 g√ºn√ºn verileri</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top:24px;">
                <div class="card-header">
                    <h2>Subdomain Listesi</h2>
                    <p>Olu≈üturduƒüunuz t√ºm subdomainler</p>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Subdomain</th>
                                <th>Hedef URL</th>
                                <th>Durum</th>
                                <th>Olu≈üturulma Tarihi</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if subdomains %}
                                {% for domain in subdomains %}
                                <tr>
                                    <td class="domain-cell">{{ domain.sub }}.supanel.org</td>
                                    <td>{{ domain.target or '-' }}</td>
                                    <td>
                                        <span class="status-badge {{ 'status-active' if domain.active else 'status-inactive' }}">
                                            {{ 'Aktif' if domain.active else 'Pasif' }}
                                        </span>
                                    </td>
                                    <td>
                                        {{ domain.created_at.split('T')[0] if domain.created_at else '-' }}
                                    </td>
                                    <td>
                                        <div class="actions">
                                            <button class="btn-action btn-edit" onclick="editDomain('{{ domain.id }}')">D√ºzenle</button>
                                            <button class="btn-action btn-delete" onclick="deleteDomain('{{ domain.id }}')">Sil</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">üåê</div>
                                            <h3>Hen√ºz Subdomain Yok</h3>
                                            <p>ƒ∞lk subdomaininizi olu≈üturmak i√ßin yukarƒ±daki formu kullanƒ±n</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleSidebar(){ document.querySelector('.sidebar').classList.toggle('active'); }

        document.getElementById('subForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const sub = document.getElementById('sub').value.trim();
            const target = document.getElementById('target').value.trim();
            const description = document.getElementById('description').value.trim();
            const alertEl = document.getElementById('alert');

            if(!sub){ showAlert('L√ºtfen subdomain adƒ± girin.','error'); return; }
            const subRegex = /^[a-z0-9\-]+$/;
            if(!subRegex.test(sub)){ showAlert('Subdomain sadece k√º√ß√ºk harf, rakam ve - i√ßerebilir.','error'); return; }
            if(target && !target.startsWith('http://') && !target.startsWith('https://')){ showAlert('Hedef URL http(s) ile ba≈ülamalƒ±.','error'); return; }

            try{
                const res = await fetch('/create-subdomain',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({sub,target,description}) });
                const j = await res.json();
                if(res.ok && j.ok){ showAlert('Subdomain olu≈üturuldu: '+j.full,'success'); document.getElementById('subForm').reset(); setTimeout(()=>location.reload(),900); }
                else showAlert('Hata: '+(j.error||res.statusText),'error');
            }catch(err){ console.error(err); showAlert('ƒ∞stek hatasƒ±','error'); }
        });

        function editDomain(id){ alert('D√ºzenleme yakƒ±nda eklenecek. ID: '+id); }
        function deleteDomain(id){
            if(!confirm('Silmek istediƒüine emin misin?')) return;
            fetch('/delete-subdomain/'+id,{method:'DELETE'}).then(r=>r.json()).then(d=>{
                if(d.ok){ showAlert('Silindi','success'); setTimeout(()=>location.reload(),900); } else showAlert('Silme hatasƒ±: '+(d.error||'hata'),'error');
            }).catch(()=>showAlert('ƒ∞stek hatasƒ±','error'));
        }

        function showAlert(msg,type='error'){
            const a=document.getElementById('alert');
            a.textContent=msg; a.className='alert alert-'+type; a.style.display='block';
            setTimeout(()=>{ a.style.display='none'; },5000);
        }
    </script>
</body>
</html>
